<!DOCTYPE html>
<html lang="en">
<head>
	<title>JS FE</title> 
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width,initial-scale=1">
</head>
<body>

	
	
	<script>
	// OOP Classes
	// class declaration
	class Animal {
		constructor(name){
			this.name = name;
			this.food = [];
		}
		sleep(){
			console.log(`${this.name} is sleeping`);
		}
		eat(food){
			this.food.push(food);
			console.log(this.food);
		}
		speak(){
			console.log(`Hi! I am ${this.name}`);
		}
	}

	const hamster = new Animal('Hamster Billy');
	hamster.speak();
	hamster.eat('Grain');
	hamster.eat('Apple');
	hamster.sleep();
	console.log(typeof Animal);

	// class Expression

	let User = class {
		registerDate = Date.now();
		constructor(name = 'Stranger', role = 'guest'){
			this.name = name;
			this._role = role;
		}

		greet(){
			console.log(`Hi! My name is ${this.name}`);
		}

		get role(){
			return this._role;
		}
		set role(value){
			if(value.length < 3){
				console.error('Too short role');
				return;
			}
			this._role = value;
		}
	}

	const admin = new User('Adminich', 'admin');
	const guest = new User();

	guest.greet();
	admin.greet();

	console.log(guest.role);
	guest.role = 'Writer';
	console.log(guest.role);


	// inheritance

	class Dog extends Animal {
		constructor(name, breed){
			super(name);
			this.breed = breed;
		}

		speak(){
			super.speak();
			console.log('Bark! Bark!');
		}

	}

	const husky = new Dog('Jay');
	husky.speak();


	// static props and methods

	class Book {
		static count = 0;
		static publisher = 'Pero';
		static compare = (book1, book2) => {
			if(book1.name > book2.name){
				return 1;
			}
			else if(book1.name < book2.name){
				return -1;
			}
			else {
				return 0;
			}
		};

		constructor(name, author){
			this.name = name;
			this.author = author;

			Book.count += 1;
		}
	}

	let books = [
		new Book('Harry Potter', 'J. Rowling'),
		new Book('The Lord of Rings', 'J. R. R. Tolkien'),
		new Book('Dzherelo', 'A. Rend')
	];

	books.sort(Book.compare);
	console.log(books);

	console.log(Book.count);

	const js = new Book('Eloquent Javascript', 'M. Haverbecke');


	// protected and private props/methods

	class Cat extends Animal {
		constructor(name, favToy){
			super(name);
			this._favToy = favToy;
		}

		get favToy(){
			return this._favToy;
		}
	}

	const murka = new Cat('Murka', 'Mouse');
	console.log(murka.favToy);
	murka.favToy = 'Sneaker';
	console.log(murka.favToy);


	// #

	class CoffeeMachine{
		#current_temp = 20;

		constructor(name, power){
			this.name = name;
			this.power = power;
			this.enabled = false;
		}

		#heat(){
			this.#current_temp = 96;
		}

		run(){
			this.enabled = true;
			setTimeout(()=>{
				this.#heat();
				console.log(`${this.name} is ready! Current Temp = ${this.#current_temp}`);
			}, this.timeout);
		}
	}

	let saeco = new CoffeeMachine('Saeco', 1000);
	// console.log(saeco.#current_temp); // SyntaxError: Private field '#current_temp' must be declared in an enclosing class
	saeco.run();



	// practice

	class KitchenDevice {
		static totalPower = 0;
		constructor(name, power){
			this.name = name;
			this.power = power;
			this.enabled = false;

			KitchenDevice.totalPower += power;
		}

		enable(){
			this.enabled = true;
			console.log(`${this.name} is enabled`);
		}
		
		disable(){
			this.enabled = false;
			console.log(`${this.name} is disabled`);
		}
	}

	class Fridge extends KitchenDevice {

		constructor(...props){
			super(...props);
			this.currentTemp = 20;
		}

		enable(){
			super.enable();
			setTimeout(()=> this.currentTemp = 3, 1500);
		}
	}

	const samsung = new Fridge('Samsung Fridge', 1400);
	samsung.enable();
	console.log(samsung.currentTemp);
	setTimeout(() => console.log(samsung.currentTemp), 1600);


	// OOP patterns, design patterns

	// singletone

	class State {
		static instance = null;
		constructor(current){
			this.current = current;

			if(State.instance == null){
				State.instance = this;
			}
			else {
				return State.instance;
			}
		}
	}

	const mainmenu = new State('Main Menu');
	const level = new State('Level'); // State{this.current: 'Main Menu'}

	console.log(mainmenu);
	console.log(level);
	level.current = 'Level 1';
	mainmenu === level; // true


	// Factory

	class Car {
		constructor(options){
			this.name = options.name;
			this.year = options.year;
			this.color = options.color;
		}
	}

	class Truck {
		constructor(options){
			this.name = options.name;
			this.year = options.year;
			this.capacity = options.capacity;
		}
	}

	class Digger {
		constructor(options){
			this.name = options.name;
			this.year = options.year;
			this.weight = options.weight;
		}
	}


	class VehicleFactory {
		static createVehicle(options){
			switch(options.type){
				case 'car': return new Car(options);
							break;
				case 'truck': return new Truck(options);
							break;
				case 'digger': return new Digger(options);
							break;
				default: return new Car(options);
							break;
			}
		}
	}

	const prius = VehicleFactory.createVehicle({
		color: 'white',
		year: 2020,
		name: 'Toyota Prius',
		type: 'car'
	});
	const man = VehicleFactory.createVehicle({
		type: 'truck',
		name: 'Man',
		capacity: 4000,
		year: 2001
	});
	const digger = VehicleFactory.createVehicle({
		type: 'digger',
		year: 2010,
		weight: 3000
	});

	const volvo = VehicleFactory.createVehicle({
		name: 'Volvo XC90',
		color: 'red',
		year: 2018
	});

	console.log(prius);
	console.log(man);
	console.log(digger);
	console.log(volvo);


	// Decorator

	const Person = class {
		constructor(name){
			this.name = name;
		}
		greet(){
			console.log(`Hello, my name is ${this.name}`);
		}
	}

	const unique = new Person('John');
	unique.hobbys = ['art', 'football', 'photography'];

	unique.greet = () => {
		Person.prototype.greet.call(unique);
		console.log(`My hobbies are ${unique.hobbys.join()}`);
	}

	unique.greet();


	// Facade

	let $ = (target) => new MemeQuery(target);

	class MemeQuery {
		constructor (target){
			this.target = target;
		}

		color(){
			if(arguments.length === 0){
				return this.target.color;
			}
			else{
				this.target.color = arguments[0];
			}
		}
	}

	const button = {
		width: 200,
		height: 50,
		color: 'green'
	}

	console.log($(button).color());
	$(button).color('pink'); // document.querySelectorAll('button')
	console.log($(button).color());


	</script>
</body>
</html>