<!DOCTYPE html>
<html lang="en">
<head>
	<title>JS FE</title> 
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width,initial-scale=1">

	<style>
		*{
			margin: 0;
			padding: 0;
			box-sizing: border-box;
		}
		
		header{
			background-color: #000000;
			color: #ffffff;
			display: flex;
			justify-content: space-between;
			align-items: center;
			padding: 10px 30px;
		}

		.logo{
			font-size: 24px;
		}

		a{
			text-decoration: none;
			color: inherit;
		}

		.shop {
			padding: 30px;
			display: flex;
			justify-content: space-between;
			align-items: flex-start;
			flex-wrap: wrap;
		}

		.coffee {
			width: 300px;
			height: 400px;
			box-shadow: 2px 2px 10px #e2e2e2;
			padding: 10px;
			display: flex;
			align-items: center;
			flex-direction: column;
			margin-bottom: 30px;
		}

		.coffee img {
			width: 100%;
			height: 150px;
			object-fit: cover;
			margin-bottom: 30px;
		}
		
		.price{
			font-size: 40px;
			font-weight: bold;
			margin: 30px 0;
		}

		.coffee button {
			padding: 10px;
			text-transform: uppercase;
		}

	</style>
</head>
<body>
	<header>
		<span class="logo">CoffeePlace</span>
		<nav>
			<a href="#">Home</a>
			<a href="#">Shop</a>
			<a href="#">Contact</a>

			<div class="cart">
				<span class="cart_items">0</span> items (<span class="cart_sum">0</span> UAH) 
			</div>
		</nav>
	</header>

	<select class="sorting">
		<option selected disabled>Sorting</option>
		<option value="name">By name (A-Z)</option>
		<option value="price">By price (Low to high)</option>
	</select>

	<div class="shop"></div>

	
	<script>
		const url = 'data.json';
		const shop = document.querySelector('.shop');
		let data;
		const cart = [];
		const cartItemsSpan = document.querySelector('.cart_items');
		const cartSumSpan = document.querySelector('.cart_sum');
		let cartCount = 0;
		let cartTotal = 0;
		const sorter = document.querySelector('.sorting');

		// XMLHttpRequest

		// const xhr = new XMLHttpRequest();
		// xhr.onreadystatechange = () =>{
		// 	if(xhr.readyState === 4 && xhr.status === 200){
		// 		data = JSON.parse(xhr.response);
		// 		buildMarkup(data);
		// 	}
		// }
		// xhr.open('GET', url);
		// xhr.send();

		function buildMarkup(d){
			d.forEach(item => {
				const div = document.createElement('div');
				div.classList.add('coffee');
				
				const pic = new Image();
				pic.src = item.img;

				const name = document.createElement('h2');
				name.textContent = item.name;

				const price = document.createElement('div');
				price.classList.add('price');
				price.textContent = item.price;

				const btn = document.createElement('button');
				btn.textContent = 'Order';
				btn.onclick = (id)=>addToCart(item.id);

				div.append(pic, name, price, btn);
				shop.append(div);
			})
		}

		function addToCart(id){
			let added;
			data.forEach(item => {
				if(item.id === id){
					added = item;
				}
			});
			let wasInCart = false;
			cart.forEach(incart => {
				if(incart.id === id){
					wasInCart = true;
					incart.count += 1;
				}
			});
			wasInCart ? null : cart.push({...added, count: 1});
			cartCount += 1;
			cartTotal += added.price;


			cartItemsSpan.textContent = cartCount;
			cartSumSpan.textContent = cartTotal;
		}

		sorter.onchange = (e) => {
			switch(sorter.value){
				case 'name': sortCoffee('h2');
					break;
				case 'price': sortCoffee('.price');
					break; 
			}
		}

		function sortCoffee(param){
			let coffees = document.querySelectorAll(`.coffee ${param}`);
			coffees = [].slice.call(coffees);
			let sortFN = param === '.price'? sortByPrice : sortByName;
			coffees.sort((a,b)=>sortFN(a,b));
			coffees.forEach((c, index) => c.parentNode.style.order = index);
		}

		function sortByName(a,b){
			if(a.innerText > b.innerText){
				return 1;
			}
			else if(a.innerText < b.innerText){
				return -1;
			}
			else {
				return 0;
			}
		}

		function sortByPrice(a,b){
			if(+a.innerText > +b.innerText){
				return 1;
			}
			else if(+a.innerText < +b.innerText){
				return -1;
			}
			else {
				return 0;
			}
		}

		// Promise

		// let promise = new Promise((resolve, reject) =>{
		// 	confirm('Delete item?') ? resolve('Item was deleted') : reject('Item was not deleted');
		// });

		// promise.then(result => console.log(result))
		// 		.catch(error => console.error(error))
		// 		//.finally(()=> console.log('Work with cart was finished'));

		
		// fetch

			let fetchedPromise = fetch(url);
			
			fetchedPromise.then(result => result.json())
						.then(response => {
							data = response;
							buildMarkup(response)
						})

				.catch(error=> console.warn(error));
	
	</script>
</body>
</html>