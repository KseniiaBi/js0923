<!DOCTYPE html>
<html lang="en">
<head>
	<title>JS FE</title> 
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width,initial-scale=1">

	<style>
		*{
			margin: 0;
			padding: 0;
			box-sizing: border-box;
		}
		
		.todoform{
			margin: 50px auto;
			display: flex;
			justify-content: space-between;
			align-items: center;
			width: 300px;
		}

		.todoform input {
			height: 40px;
			border-radius: 3px;
			padding: 10px;
			border: 1px solid #e2e2e2;
		}
		.todoinput{
			width: calc(100% - 60px);
		}
		input[type='submit'] {
			background: hotpink;
			color: #ffffff;
			text-transform: uppercase;
		}

		h3{
			text-align: center;
		}

		ol{
			margin: 50px;
		}

		.done {
			text-decoration: line-through;
		}

		.del_btn, .edit_btn {
			display: inline-block;
			margin-left: 20px;
			width: 26px;
			height: 26px;
			cursor: pointer;
		}

		.del_btn {
			background: url('delete.png') no-repeat center;
			background-size: contain;
		}
		.edit_btn {
			background: url('edit.png') no-repeat center;
			background-size: contain;
		}

		.hidden {
			display: none;
		}

		h1{
			margin: 150px 50px;
		}
		.typewriter {
			position: relative;
		}
		.typewriter::after {
			content: "|";
			animation: blink 1s linear infinite;
		}

		@keyframes blink {
			0%, 20%, 80%, 100% {
				opacity: 0;
			}

			50% {
				opacity: 1;
			}
		}

	</style>
</head>
<body>

	<form class="todoform">
		<input type="text" class="todoinput" placeholder="Type your task">
		<input type="submit" value="save">
	</form>

	<h3>Any tasks yet. Start with adding tasks in form above.</h3>
	<ol class="todolist"></ol>

	<h1>Hello, I am <span class="typewriter"></span></h1>
	
	<script>
		// To Do List
		// save task +
		// mark as done +
		// delete task + 
		// edit task + 
		// save to LS +

		const form = document.getElementsByClassName('todoform')[0];
		const todoinp = document.querySelector('.todoinput');
		const heading = document.getElementsByTagName('h3')[0];
		const list = document.querySelector('.todolist');
		const storage = window.localStorage;
		const APP_NAME = 'TODOS';
		let todos;
		const inStorage = storage.getItem(APP_NAME);

		if(inStorage === null || JSON.parse(inStorage).length === 0){
			todos = [];
		}
		else{
			todos = JSON.parse(inStorage);
			todos.forEach(item => createTodoMarkup(item));
		}

		function saveToLS(){
			storage.setItem(APP_NAME, JSON.stringify(todos));
		}

		function checkTodos(){
			if(todos.length === 0){
				heading.style.display = 'block';
				list.style.display = 'none';
			}
			else{
				heading.style.display = 'none';
				list.style.display = 'block';
			}
		}
		checkTodos();

		function saveTask(){
			const text = todoinp.value;
			if(text.length >= 3){
				const id = Date.now();
				const todo = {
					task: text,
					done: false,
					id: id
				}
				todos.push(todo);
				createTodoMarkup(todo);
				todoinp.value = '';

				if(todos.length === 1){
					checkTodos();
				}
				saveToLS();
			}
		}

		function createTodoMarkup(todo){
			const li = document.createElement('li');
			li.dataset.id = todo.id;

			li.append(createHTMLelement('span', ['textspan'], todo.task, () => markAsDone(li)));
			li.appendChild(createHTMLelement('input', ['hidden'] ));
			li.appendChild(createHTMLelement('span', ['del_btn'], '', () => deleteTask(li)));
			li.appendChild(createHTMLelement('span', ['edit_btn'], '', () => editTask(li)));

			list.append(li);
		}

		function createHTMLelement(tag, classes = [], text = '', handler = null){
			const elem = document.createElement(tag);
			elem.classList.add(...classes);
			elem.textContent = text;
			elem.onclick = handler;
			return elem;
		}

		function markAsDone(el){
			el.classList.toggle('done');
			todos.forEach(item => {
				if(item.id === +el.dataset.id){
					item.done = !item.done;
				}
			});
			saveToLS();
		}

		function deleteTask(el){
			const id = +el.dataset.id;
			el.remove();
			todos.forEach((item, index) => {
				if(item.id === id){
					todos.splice(index, 1);
				}
			});
			if(todos.length === 0){
				checkTodos();
			}
			saveToLS();
		}

		function editTask(el){
			const id = +el.dataset.id;
			const txt = el.querySelector('.textspan');
			const inp = el.querySelector('input');

			inp.value = txt.innerText;
			inp.classList.remove('hidden');
			txt.classList.add('hidden');

			inp.onkeyup = (e) => {
				if(e.key === 'Enter'){
					txt.innerText = inp.value;
					inp.classList.add('hidden');
					txt.classList.remove('hidden');

					todos.forEach(item => {
						if(item.id === id){
							item.task = inp.value;
						}
					});
					inp.onkeyup = null;
				}
			}
			saveToLS();
		}

		form.onsubmit = (e) =>{
			e.preventDefault();
			saveTask();
		}

		// list.addEventListener('click', (event) => {
		// 	if(event.target.parentNode.tagName.toLowerCase() === 'li'){
		// 		markAsDone(event.target.parentNode);
		// 	}
		// });


		// typewriter effect
		const phrases = ['JS developer', 'Designer', 'Human'];
		const placeholder = document.getElementsByClassName('typewriter')[0];
		let totalTime = 0;

		for(let p of phrases){
			let time = p.length*100 + 1500;
			setTimeout(()=>{
				typewrite(p);
			}, totalTime);

			totalTime +=  time;
		}

		function typewrite(text){
			let letter = 0;
			let interval = setInterval(() =>{
				if(letter < text.length){
					placeholder.textContent += text.charAt(letter);
					letter++;
				}
				else{
					clearInterval(interval);
					setTimeout(()=>{
						placeholder.textContent = ''; // text.substring(0, i--)
					}, 500);
				}
			}, 100);
		}
	
		</script>
</body>
</html>